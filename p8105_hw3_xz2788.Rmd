---
title: "p8105_hw3_xz2788"
author: "Xiaoyue Zhang"
date: "10/4/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Problem 1

Load dataset and package

```{r load_dataset_package}
library(p8105.datasets)
library(tidyverse)
```

Look at the data first

```{r overview_data, eval=FALSE}
str(brfss_smart2010)
head(brfss_smart2010)
tail(brfss_smart2010)
View(brfss_smart2010)
```

Tidy the data

```{r tidy_data}
brfss_smart2010_tidy = janitor::clean_names(brfss_smart2010) %>%
  filter(topic == "Overall Health") %>% 
  rename(state = locationabbr, county = locationdesc) %>% 
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor"))
```

Convert the "response" variable into a factor

```{r convert_to_factor}
brfss_smart2010_tidy$response = factor(brfss_smart2010_tidy$response, 
                      levels = c("Excellent", "Very good", "Good", "Fair", "Poor"))
```

## which states were observed at 7 locations

```{r state_at_seven_locations}
brfss_smart2010_tidy %>% 
  group_by(state) %>% 
  summarize(n_location = n_distinct(geo_location)) %>% 
  filter(n_location == 7)
```

There are seven states were observed at 7 locations. These are:
"Connecticut (CT)", "Montana (MT)", "New Hampshire (NH)", "New Mexico (NM)", "Oregon (OR)", "Tennessee (TN)", "Utah (UT)"

## "Spaghetti plot"

```{r spaghetti_plot}
brfss_smart2010_tidy %>% 
  group_by(state, year) %>% 
  summarize(n_obs = sum(sample_size)) %>% 
  ggplot(aes(x = year, y = n_obs)) + 
  geom_line(aes(color = state)) +
  labs(
    title = "Observation plot",
    x = "Year",
    y = "Number of observations"
  )
```

## Making a table

```{r make_table}
filter(brfss_smart2010_tidy, 
       state == "NY",
       year %in% c(2002, 2006, 2010),
       response == "Excellent") %>%
  group_by(year) %>% 
  summarize(sd_prop = sd(data_value),
            mean_prop = mean(data_value)) %>% 
  knitr::kable(digits = 2)
```

## Five-panel plot

```{r make_five_panel_plot}
brfss_smart2010_tidy %>% 
  group_by(state, year, response) %>% 
  summarize(average_prop = mean(data_value)) %>% 
  ggplot(aes(x = year, y = average_prop)) +
  geom_line(aes(color = state)) +
  facet_grid(. ~ response) +
   theme(legend.position = "bottom")
```

# Problem 2

View the data first

```{r p2_data, eval=FALSE}
View(instacart)
head(instacart)
tail(instacart)
str(instacart)
dim(instacart)
skimr::skim(instacart)
```

There are 1,384,617 observations and 15 variables in this dataset. Each row represents a product from an online order and contains information about the time of the order, product of the order, the previous ordering history from this same customer. Only the evaluation set that the order belongs to, product name, aisle identifier and name of department are character variables. Others are integers. There are no missing values in the dataset.

For example, in the first row, it shows the product "Bulgarian Yogurt" ordered by the user with ID "112108" and it was ordered from the cart at 10:00 am on Thursday. This customer also bought this same product 9 days ago.

## How many aisles and which are the most items ordered from?

```{r}

```

